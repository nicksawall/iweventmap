:root { --panel-w: 360px; }

html, body { height: 100%; margin: 0; }
body { background:#dde6f1; }

#app {
  height: 100vh;
  min-height: 480px;
  display: grid;
  grid-template-columns: var(--panel-w) 1fr;
  grid-template-areas: "sidebar map";  /* explicit placement */
  transition: grid-template-columns .25s ease;
  position: relative;
}
#app.collapsed { grid-template-columns: 0px 1fr; }

#sidebar { grid-area: sidebar; }
#map { grid-area: map; }

#sidebar {
  border-right: 1px solid #e5e5e5;
  padding: 10px;
  overflow: auto;
  transition: opacity .2s ease;
  background: #fff;
  z-index: 2;
}
#app.collapsed #sidebar { opacity: 0; pointer-events: none; }

#map {
  position: relative;
  width: 100%;
  height: 100vh;     /* desktop solid height */
  min-height: 520px; /* safety min */
  z-index: 5;
  background: #eef3f8; /* visible even before tiles */
}
.leaflet-container { height: 100% !important; width: 100% !important; }

/* Force Leaflet tiles to show (workaround for fade/animation race) */
.leaflet-tile {
  opacity: 1 !important;
  filter: none !important;
  transition: none !important;
}

.leaflet-container { font: 14px/1.3 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }

/* Overlay toggles */
.map-overlay {
  position: absolute;
  top: 12px; left: 12px;
  z-index: 1004;
  display: flex; gap: 10px; align-items: center;
  background: #ffffffcc; backdrop-filter: blur(4px);
  border: 1px solid #ddd; border-radius: 8px;
  padding: 6px 10px; font-size: 13px;
}
.map-overlay label {line-height: 1.2; display: inline-flex; align-items: center; gap: 6px; cursor: pointer; user-select: none; }

/* Logo chips */
.dot-img {
  width: 24px;
  height: 24px;
  object-fit: contain;
  vertical-align: middle;
}

/* Reset button */
.btn-reset{
  position:absolute; top:12px; right:12px; z-index:1004;
  border:1px solid #ddd; padding:6px 8px; background:#ffffffcc; border-radius:6px; cursor:pointer;
}

/* Drawer toggle */
#toggleListFloating {
  position: absolute;
  top: 52px; left: 12px;
  z-index: 1004;
  padding: 8px 10px;
  font-size: 16px;
  border: 1px solid #ddd;
  background: #ffffffcc;
  backdrop-filter: blur(4px);
  border-radius: 6px;
  cursor: pointer;
  line-height: 1;
}

/* Controls */
.controls { display: grid; grid-template-columns: 1fr; gap: 8px; margin-bottom: 8px; }
.row { display: flex; gap: 6px; align-items: center; }
.controls button, .controls input, .controls select {
  padding: 4px 8px; font-size: 13px; border: 1px solid #ddd; border-radius: 6px;
}
#locBtn, #setLocBtn { font-size: 12.5px; padding: 4px 8px; }
#locInput, #searchInput { flex: 1; min-width: 140px; }
#sortSel { min-width: 150px; }

/* List items */
.item { padding: 8px 6px; border-radius: 8px; border: 1px solid #eee; margin-bottom: 8px; cursor: pointer; background:#fff; }
.item h4 { margin: 0 0 4px; font-size: 15px; display: flex; align-items: center; gap: 6px; }
.item h4 img { width: 14px; height: 14px; object-fit: contain; }
.meta { font-size: 12.5px; color: #444; }

/* Popups */
.popup h3 { margin: 0 0 4px; font-size: 16px; }
.popup .meta { font-size: 13px; margin: 2px 0; color: #333; }
.popup .desc { margin-top: 6px; white-space: pre-wrap; max-width: 320px; }

/* Mobile drawer + dynamic viewport height */
@media (max-width: 900px) {
  :root { --panel-w: 86vw; }
  #app { display: block; height: 100dvh; }
  #sidebar {
    position: fixed; left: 0; top: 0;
    width: var(--panel-w); height: 100dvh;
    box-shadow: 0 8px 24px rgba(0,0,0,.18);
    transform: translateX(-100%);
    transition: transform .25s ease;
    z-index: 1002; /* above backdrop */
  }
  #app.drawer-open #sidebar { transform: translateX(0); }

  #backdrop {
    position: fixed; inset: 0;
    background: rgba(0,0,0,.28);
    opacity: 0; pointer-events: none;
    transition: opacity .25s ease;
    z-index: 1001; /* under sidebar */
  }
  #app.drawer-open #backdrop { opacity: 1; pointer-events: auto; }

  #map { height: 100dvh; }
  .map-overlay { top: 10px; left: 10px; font-size: 14px; }
  #toggleListFloating { top: 56px; left: 10px; padding: 10px 12px; font-size: 18px; z-index: 1004; }

  #app.collapsed.drawer-open #sidebar { opacity: 1; pointer-events: auto; }
}

/* Loading badge */
#loading {
  position: absolute; bottom: 12px; left: 12px; z-index: 1003;
  background: #fff; border: 1px solid #ddd; border-radius: 6px;
  padding: 6px 8px; font-size: 12.5px;
  box-shadow: 0 2px 8px rgba(0,0,0,.06);
}
